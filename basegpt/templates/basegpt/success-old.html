{% load static %}
<html>
<head>
    <title>GPT</title>

<!--    <link rel="stylesheet" href="{% static 'css/main.css' %}">-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
<div id="object-container">

    <a href="{% url 'home' %}">Home</a>


    <h3>выберете запрос и Дождитесь результата</h3>
    {% csrf_token %}
    {% for object in objects %}
    {% if object.rawtext %}
    <pre>{{object.rawtext}}</pre>
    {% endif %}

    {% if object.rawfile %}
    {% csrf_token %}
    <a href = "{{object.rawfile.url}}" download="">rawfile.txt</a>



    {% endif %}
    <input type="submit" class="submitexe" value="{{object.order}}" id = "{{object.order}}"  name = "{{object.id}}"/>

    <div id="response-div" style="display: none;">
    </div>
    <br>
    <br>
    <br>
    {% endfor %}
<div id="loader-div" style="display: none;">
      Loading...
    </div>
    {% for object in exam_objects %}
    {% if object.rawtext %}
    <pre>{{object.rawtext}}</pre>
    {% endif %}
 <input type="submit" class="submitexe" value="{{object.order}}" id = "{{object.order}}"  name = "{{object.id}}"/>

    <pre><div id="response-div" style="display: none;">



</div></pre>

    {% endfor %}


</div>

</body>


<script>
<!--const responseDiv = document.getElementById('response-div');-->
<!--const loaderDiv = document.getElementById('loader-div');-->
<!--const submitButton = document.getElementById('submitexe');-->

<!--// Attach an event listener to the button-->
<!--submitButton.addEventListener('click', (event) => {-->
<!--  // Prevent the default form submission behavior-->
<!--  event.preventDefault();-->

<!--  // Get the value of the button-->
<!--  const buttonValue = event.target.value;-->
<!--  loaderDiv.style.display = 'block';-->
<!--  responseDiv.style.display = 'none';-->

<!--  // Send a POST request to the server-->
<!--  fetch('/success', {-->
<!--    method: 'POST',-->
<!--    body: JSON.stringify({ buttonValue }),-->
<!--    headers: {-->
<!--      'Content-Type': 'application/json',-->
<!--      'X-CSRFToken': document.getElementsByName('csrfmiddlewaretoken')[0].value-->
<!--      }-->
<!--  })-->
<!--.then(response => {-->
<!--  return response.json(); // This converts the response to JSON-->
<!--})-->
<!--.then(data => {-->
<!--  // This updates the textContent of the div with id "response-div" to show the 'response_text' field-->
<!--  if (data['type'] === 'text') {-->
<!--    responseDiv.textContent = data['response_text'];-->
<!--    } else if (data['type'] === 'file') {-->
<!--    responseDiv.innerHTML = `<a href="${data['file_url']}" download>Download file</a>`;-->
<!--    } else if (data['type'] === 'error') {-->
<!--        responseDiv.textContent = data['error'];-->
<!--        submitButton.disabled = true;-->





<!--    }-->

<!--    responseDiv.style.display = 'block';-->
<!--    loaderDiv.style.display = 'none';-->


<!--});-->
<!--});-->





const responseDiv = document.getElementById('response-div');
const loaderDiv = document.getElementById('loader-div');
const buttons = document.querySelectorAll ('.submitexe');

// Attach an event listener to the button
buttons.forEach(function(button) {
button.addEventListener('click', (event) => {
  // Prevent the default form submission behavior
  event.preventDefault();

  // Get the value of the button
  const buttonValue = event.target.value;
  loaderDiv.style.display = 'block';
  responseDiv.style.display = 'none';


  fetch('/success', {
    method: 'POST',
    body: JSON.stringify({ buttonValue }),
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': document.getElementsByName('csrfmiddlewaretoken')[0].value
      },

  })


.then(response => {

 return response.json(); // This converts the response to JSON
})




.then(data => {
  // This updates the textContent of the div with id "response-div" to show the 'response_text' field
  if (data['type'] === 'text') {
    responseDiv.textContent = data['response_text'];
    var submitButton = document.getElementById(buttonValue);
    submitButton.disabled = true;
    } else if (data['type'] === 'file') {
    responseDiv.innerHTML = `<a href="${data['file_url']}" download>Download file</a>`;
    var submitButton = document.getElementById(buttonValue);
    submitButton.disabled = true;
    } else if (data['type'] === 'error') {
        responseDiv.textContent = data['error'];
        var submitButton = document.getElementById(buttonValue);
        submitButton.disabled = true;




}



    responseDiv.style.display = 'block';
    loaderDiv.style.display = 'none';




})
<!--.catch(error => {-->
<!--    console.error(error);-->
<!--  });-->
});
});



</script>
<style>
    #loader-div {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.7);
  z-index: 9999;
  text-align: center;
  font-size: 20px;
}

#loader-div::after {
  content: "Loading...";
  display: inline-block;
  margin-top: 25%;
  animation: rotate 1s linear infinite;
}

@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

#response-div {
  margin-top: 20px;
  font-size: 24px;
}
</style>



